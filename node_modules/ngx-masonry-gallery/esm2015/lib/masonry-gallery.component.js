/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, EventEmitter, Input, Output, Renderer2, ChangeDetectionStrategy, } from '@angular/core';
import imagesLoadedMethod from 'imagesloaded';
import * as masonry from 'masonry-layout';
import { utilities } from './utilities';
import * as Éµngcc0 from '@angular/core';

const _c0 = [3, "id"];
export class MasonryGalleryComponent {
    /**
     * @param {?} renderer
     */
    constructor(renderer) {
        this.renderer = renderer;
        this.images = [];
        this.width = 330;
        this.gutter = 5;
        this.verticalGutter = 5;
        this.imageClasses = [];
        this.clickImage = new EventEmitter();
        this.removeComplete = new EventEmitter();
        this.layoutComplete = new EventEmitter();
        this.galleryGuid = utilities.newGuid();
        this.mansonryItemSelectorClass = `grid-item-${this.galleryGuid}`;
        this.activeImages = [];
        this.viewReady = false;
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (changes.images && changes.images.currentValue) {
            if (!this.viewReady) {
                // process images once we can
                this.changesToProcess = changes;
            }
            else {
                this.processImages(changes);
            }
        }
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        if (this.msnry) {
            this.msnry.destroy();
        }
    }
    /**
     * @param {?} image
     * @return {?}
     */
    handleClick(image) {
        this.clickImage.next(image);
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        this.viewReady = true;
        this.initMasonry();
        // process images now
        if (this.changesToProcess) {
            this.processImages(this.changesToProcess);
            this.changesToProcess = undefined;
        }
    }
    /**
     * @param {?} images
     * @return {?}
     */
    addImages(images) {
        if (images && images.length > 0) {
            this.addImagesToGallery(images);
        }
    }
    /**
     * @param {?} images
     * @return {?}
     */
    removeImages(images) {
        if (images && images.length > 0) {
            images.forEach((/**
             * @param {?} image
             * @return {?}
             */
            image => {
                this.removeImageFromGallery(image);
            }));
        }
    }
    /**
     * @private
     * @param {?} changes
     * @return {?}
     */
    processImages(changes) {
        /** @type {?} */
        const imagesToProcess = this.getAddedAndRemovesImages(changes);
        // add images to mansonry layout
        this.addImages(imagesToProcess.addedImages);
        // removes images from layout
        this.removeImages(imagesToProcess.removedImages);
    }
    /**
     * @private
     * @param {?} changes
     * @return {?}
     */
    getAddedAndRemovesImages(changes) {
        /** @type {?} */
        let addedImages = [];
        /** @type {?} */
        const removedImages = [];
        /** @type {?} */
        const newImagesValue = (/** @type {?} */ (changes.images
            .currentValue));
        /** @type {?} */
        const oldImagesValue = (/** @type {?} */ (changes.images
            .previousValue));
        if (!oldImagesValue) {
            // all images are new ones
            addedImages = changes.images.currentValue;
        }
        else {
            // process added images
            newImagesValue.forEach((/**
             * @param {?} newImage
             * @return {?}
             */
            newImage => {
                /** @type {?} */
                const existingImage = oldImagesValue.find((/**
                 * @param {?} m
                 * @return {?}
                 */
                m => m.imageUrl.toLowerCase() === newImage.imageUrl.toLowerCase()));
                if (existingImage) {
                    // image was in previous value && is in new, do nothing
                }
                else {
                    // image is new
                    addedImages.push(newImage);
                }
            }));
            // process removed images
            oldImagesValue.forEach((/**
             * @param {?} oldImage
             * @return {?}
             */
            oldImage => {
                /** @type {?} */
                const existingImage = newImagesValue.find((/**
                 * @param {?} m
                 * @return {?}
                 */
                m => m.imageUrl.toLowerCase() === oldImage.imageUrl.toLowerCase()));
                if (existingImage) {
                    // image was in previous value && is in new, do nothing
                }
                else {
                    // image is removed
                    removedImages.push(oldImage);
                }
            }));
        }
        return {
            addedImages: addedImages,
            removedImages: removedImages
        };
    }
    /**
     * @private
     * @return {?}
     */
    initMasonry() {
        this.grid = document.getElementById(this.galleryGuid);
        // remove all existing data from grid
        this.grid.innerHTML = '';
        if (!this.grid) {
            throw Error(`Could not init mansory due to non existing elem with id '${this.galleryGuid}'`);
        }
        this.msnry = new masonry(this.grid, {
            // options...
            itemSelector: '.' + this.mansonryItemSelectorClass,
            columnWidth: this.width,
            gutter: this.gutter,
        });
        /** @type {?} */
        const that = this;
        this.msnry.on('layoutComplete', (/**
         * @param {?} items
         * @return {?}
         */
        function (items) {
            that.layoutComplete.next(items);
        }));
        this.msnry.on('removeComplete', (/**
         * @param {?} items
         * @return {?}
         */
        function (items) {
            that.removeComplete.next(items);
        }));
    }
    /**
     * @private
     * @param {?} image
     * @return {?}
     */
    removeImageFromGallery(image) {
        // get image guid
        /** @type {?} */
        const imageIdResult = this.activeImages.find((/**
         * @param {?} m
         * @return {?}
         */
        m => m.image.imageUrl.toLowerCase() === image.imageUrl.toLowerCase()));
        if (!imageIdResult) {
            // image was not found, this is probably an error
            console.warn(`Image with url '${image.imageUrl}' was not found. If you are adding images, make sure to 'replace' the images array with a new one
                so that detection change can be executed instead of just adding an image to array
                (which doesn't fire change detection on array property)`);
            return;
        }
        // find image based on its id
        /** @type {?} */
        const imageElem = document.getElementById(imageIdResult.id);
        if (!imageElem) {
            // image was not found in DOM
            console.warn(`Image with id '{${imageIdResult.id}}' was not found in DOM. Have you manipulated the DOM in some way?`);
            return;
        }
        // remove image from gallery
        this.msnry.remove(imageElem);
        // refresh layout
        this.msnry.layout();
        // remove image from array
        for (let i = 0; i < this.activeImages.length; i++) {
            /** @type {?} */
            const idWithImage = this.activeImages[i];
            if (idWithImage.image.imageUrl.toLowerCase() ===
                imageIdResult.image.imageUrl.toLowerCase()) {
                this.activeImages.splice(i, 1);
            }
        }
    }
    /**
     * @private
     * @param {?} images
     * @return {?}
     */
    addImagesToGallery(images) {
        if (!this.grid) {
            throw Error('Grid element is not yet ready, are you trying to add image too soon?');
        }
        /** @type {?} */
        const imagesWrapper = this.renderer.createElement('span');
        images.forEach((/**
         * @param {?} image
         * @return {?}
         */
        image => {
            // generate unique image id
            /** @type {?} */
            const imageId = this.getImageId();
            // create element
            /** @type {?} */
            const imageElem = this.renderer.createElement('img');
            imageElem.setAttribute('id', imageId);
            imageElem.setAttribute('alt', image.alt ? image.alt : 'no description');
            imageElem.setAttribute('src', image.imageUrl);
            // note - images are hidden by default and should be shown only after they are loaded
            imageElem.setAttribute('style', `display: none; width: ${this.width}px; margin-bottom: ${this.verticalGutter}px`);
            imageElem.className = this.getImageClass();
            imageElem.addEventListener('click', (/**
             * @return {?}
             */
            () => {
                this.handleClick(image);
            }));
            // store guid with this image
            this.activeImages.push({
                id: imageId,
                image: image
            });
            // add to dom and mansory & refresh layout
            this.renderer.appendChild(imagesWrapper, imageElem);
        }));
        // add html to dom
        this.renderer.appendChild(this.grid, imagesWrapper);
        // add images once they are loaded
        /** @type {?} */
        const imgLoad = imagesLoadedMethod(imagesWrapper);
        imgLoad.on('progress', (/**
         * @param {?} instance
         * @param {?} image
         * @return {?}
         */
        (instance, image) => {
            if (image.isLoaded) {
                this.renderer.appendChild(this.grid, image.img);
                // unhide image
                this.renderer.setStyle(image.img, 'display', 'block');
                this.msnry.appended(image.img);
                this.msnry.reloadItems();
            }
        }));
    }
    /**
     * @private
     * @return {?}
     */
    getImageClass() {
        /** @type {?} */
        let className = this.mansonryItemSelectorClass;
        if (this.imageClasses && this.imageClasses.length > 0) {
            /** @type {?} */
            const customClass = this.imageClasses.join(' ');
            className += ' ' + customClass;
        }
        return className;
    }
    /**
     * @private
     * @return {?}
     */
    getImageId() {
        return this.galleryGuid + '_' + utilities.newGuid();
    }
}
MasonryGalleryComponent.ngComponentDef = Éµngcc0.ÉµÉµdefineComponent({ type: MasonryGalleryComponent, selectors: [["ngx-masonry-gallery"]], factory: function MasonryGalleryComponent_Factory(t) { return new (t || MasonryGalleryComponent)(Éµngcc0.ÉµÉµdirectiveInject(Renderer2)); }, inputs: { images: "images", width: "width", gutter: "gutter", verticalGutter: "verticalGutter", imageClasses: "imageClasses" }, outputs: { clickImage: "clickImage", removeComplete: "removeComplete", layoutComplete: "layoutComplete" }, features: [Éµngcc0.ÉµÉµNgOnChangesFeature()], consts: 1, vars: 1, template: function MasonryGalleryComponent_Template(rf, ctx) { if (rf & 1) {
        Éµngcc0.ÉµÉµelement(0, "div", _c0);
    } if (rf & 2) {
        Éµngcc0.ÉµÉµproperty("id", ctx.galleryGuid);
    } }, encapsulation: 2, changeDetection: 0 });
/*@__PURE__*/ Éµngcc0.ÉµsetClassMetadata(MasonryGalleryComponent, [{
        type: Component,
        args: [{
                changeDetection: ChangeDetectionStrategy.OnPush,
                selector: 'ngx-masonry-gallery',
                template: '<div [id]="galleryGuid"></div>'
            }]
    }], function () { return [{ type: Renderer2 }]; }, { constructor: [], renderer: [], images: [{
            type: Input
        }], width: [{
            type: Input
        }], gutter: [{
            type: Input
        }], verticalGutter: [{
            type: Input
        }], imageClasses: [{
            type: Input
        }], clickImage: [{
            type: Output
        }], removeComplete: [{
            type: Output
        }], layoutComplete: [{
            type: Output
        }], galleryGuid: [], mansonryItemSelectorClass: [], activeImages: [], viewReady: [], ngOnChanges: [], changesToProcess: [], ngOnDestroy: [], handleClick: [], ngAfterViewInit: [], addImages: [], removeImages: [], processImages: [], getAddedAndRemovesImages: [], initMasonry: [], grid: [], msnry: [], removeImageFromGallery: [], addImagesToGallery: [], getImageClass: [], getImageId: [] });
/** @nocollapse */
MasonryGalleryComponent.ctorParameters = () => [
    { type: Renderer2 }
];
MasonryGalleryComponent.propDecorators = {
    images: [{ type: Input }],
    width: [{ type: Input }],
    gutter: [{ type: Input }],
    verticalGutter: [{ type: Input }],
    imageClasses: [{ type: Input }],
    clickImage: [{ type: Output }],
    removeComplete: [{ type: Output }],
    layoutComplete: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    MasonryGalleryComponent.prototype.images;
    /** @type {?} */
    MasonryGalleryComponent.prototype.width;
    /** @type {?} */
    MasonryGalleryComponent.prototype.gutter;
    /** @type {?} */
    MasonryGalleryComponent.prototype.verticalGutter;
    /** @type {?} */
    MasonryGalleryComponent.prototype.imageClasses;
    /** @type {?} */
    MasonryGalleryComponent.prototype.clickImage;
    /** @type {?} */
    MasonryGalleryComponent.prototype.removeComplete;
    /** @type {?} */
    MasonryGalleryComponent.prototype.layoutComplete;
    /** @type {?} */
    MasonryGalleryComponent.prototype.galleryGuid;
    /**
     * @type {?}
     * @private
     */
    MasonryGalleryComponent.prototype.mansonryItemSelectorClass;
    /**
     * @type {?}
     * @private
     */
    MasonryGalleryComponent.prototype.activeImages;
    /**
     * @type {?}
     * @private
     */
    MasonryGalleryComponent.prototype.msnry;
    /**
     * @type {?}
     * @private
     */
    MasonryGalleryComponent.prototype.grid;
    /**
     * @type {?}
     * @private
     */
    MasonryGalleryComponent.prototype.changesToProcess;
    /**
     * @type {?}
     * @private
     */
    MasonryGalleryComponent.prototype.viewReady;
    /**
     * @type {?}
     * @private
     */
    MasonryGalleryComponent.prototype.renderer;
}
/**
 * @record
 */
function ActiveImage() { }
if (false) {
    /** @type {?} */
    ActiveImage.prototype.id;
    /** @type {?} */
    ActiveImage.prototype.image;
}

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImM6L1VzZXJzL3R6aW9uL09uZURyaXZlL9ee16HXnteb15nXnS9Qcml2YXRlL0FydGljbGVTdGFjay1tYXN0ZXIvQXJ0aWNsZVN0YWNrLW1hc3Rlci9ub2RlX21vZHVsZXMvbmd4LW1hc29ucnktZ2FsbGVyeS9lc20yMDE1L2xpYi9tYXNvbnJ5LWdhbGxlcnkuY29tcG9uZW50LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7OztBQVFBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztDQW9VQywyWUFPQyIsImZpbGUiOiJtYXNvbnJ5LWdhbGxlcnkuY29tcG9uZW50LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IGFkZGVkIGJ5IHRzaWNrbGVcbiAqIEBzdXBwcmVzcyB7Y2hlY2tUeXBlcyxleHRyYVJlcXVpcmUsbWlzc2luZ092ZXJyaWRlLG1pc3NpbmdSZXR1cm4sdW51c2VkUHJpdmF0ZU1lbWJlcnMsdXNlbGVzc0NvZGV9IGNoZWNrZWQgYnkgdHNjXG4gKi9cbmltcG9ydCB7IENvbXBvbmVudCwgRXZlbnRFbWl0dGVyLCBJbnB1dCwgT3V0cHV0LCBSZW5kZXJlcjIsIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IGltYWdlc0xvYWRlZE1ldGhvZCBmcm9tICdpbWFnZXNsb2FkZWQnO1xuaW1wb3J0ICogYXMgbWFzb25yeSBmcm9tICdtYXNvbnJ5LWxheW91dCc7XG5pbXBvcnQgeyB1dGlsaXRpZXMgfSBmcm9tICcuL3V0aWxpdGllcyc7XG5leHBvcnQgY2xhc3MgTWFzb25yeUdhbGxlcnlDb21wb25lbnQge1xuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7P30gcmVuZGVyZXJcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihyZW5kZXJlcikge1xuICAgICAgICB0aGlzLnJlbmRlcmVyID0gcmVuZGVyZXI7XG4gICAgICAgIHRoaXMuaW1hZ2VzID0gW107XG4gICAgICAgIHRoaXMud2lkdGggPSAzMzA7XG4gICAgICAgIHRoaXMuZ3V0dGVyID0gNTtcbiAgICAgICAgdGhpcy52ZXJ0aWNhbEd1dHRlciA9IDU7XG4gICAgICAgIHRoaXMuaW1hZ2VDbGFzc2VzID0gW107XG4gICAgICAgIHRoaXMuY2xpY2tJbWFnZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICAgICAgdGhpcy5yZW1vdmVDb21wbGV0ZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICAgICAgdGhpcy5sYXlvdXRDb21wbGV0ZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICAgICAgdGhpcy5nYWxsZXJ5R3VpZCA9IHV0aWxpdGllcy5uZXdHdWlkKCk7XG4gICAgICAgIHRoaXMubWFuc29ucnlJdGVtU2VsZWN0b3JDbGFzcyA9IGBncmlkLWl0ZW0tJHt0aGlzLmdhbGxlcnlHdWlkfWA7XG4gICAgICAgIHRoaXMuYWN0aXZlSW1hZ2VzID0gW107XG4gICAgICAgIHRoaXMudmlld1JlYWR5ID0gZmFsc2U7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7P30gY2hhbmdlc1xuICAgICAqIEByZXR1cm4gez99XG4gICAgICovXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlcykge1xuICAgICAgICBpZiAoY2hhbmdlcy5pbWFnZXMgJiYgY2hhbmdlcy5pbWFnZXMuY3VycmVudFZhbHVlKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMudmlld1JlYWR5KSB7XG4gICAgICAgICAgICAgICAgLy8gcHJvY2VzcyBpbWFnZXMgb25jZSB3ZSBjYW5cbiAgICAgICAgICAgICAgICB0aGlzLmNoYW5nZXNUb1Byb2Nlc3MgPSBjaGFuZ2VzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5wcm9jZXNzSW1hZ2VzKGNoYW5nZXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEByZXR1cm4gez99XG4gICAgICovXG4gICAgbmdPbkRlc3Ryb3koKSB7XG4gICAgICAgIGlmICh0aGlzLm1zbnJ5KSB7XG4gICAgICAgICAgICB0aGlzLm1zbnJ5LmRlc3Ryb3koKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBAcGFyYW0gez99IGltYWdlXG4gICAgICogQHJldHVybiB7P31cbiAgICAgKi9cbiAgICBoYW5kbGVDbGljayhpbWFnZSkge1xuICAgICAgICB0aGlzLmNsaWNrSW1hZ2UubmV4dChpbWFnZSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEByZXR1cm4gez99XG4gICAgICovXG4gICAgbmdBZnRlclZpZXdJbml0KCkge1xuICAgICAgICB0aGlzLnZpZXdSZWFkeSA9IHRydWU7XG4gICAgICAgIHRoaXMuaW5pdE1hc29ucnkoKTtcbiAgICAgICAgLy8gcHJvY2VzcyBpbWFnZXMgbm93XG4gICAgICAgIGlmICh0aGlzLmNoYW5nZXNUb1Byb2Nlc3MpIHtcbiAgICAgICAgICAgIHRoaXMucHJvY2Vzc0ltYWdlcyh0aGlzLmNoYW5nZXNUb1Byb2Nlc3MpO1xuICAgICAgICAgICAgdGhpcy5jaGFuZ2VzVG9Qcm9jZXNzID0gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7P30gaW1hZ2VzXG4gICAgICogQHJldHVybiB7P31cbiAgICAgKi9cbiAgICBhZGRJbWFnZXMoaW1hZ2VzKSB7XG4gICAgICAgIGlmIChpbWFnZXMgJiYgaW1hZ2VzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHRoaXMuYWRkSW1hZ2VzVG9HYWxsZXJ5KGltYWdlcyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogQHBhcmFtIHs/fSBpbWFnZXNcbiAgICAgKiBAcmV0dXJuIHs/fVxuICAgICAqL1xuICAgIHJlbW92ZUltYWdlcyhpbWFnZXMpIHtcbiAgICAgICAgaWYgKGltYWdlcyAmJiBpbWFnZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgaW1hZ2VzLmZvckVhY2goKC8qKlxuICAgICAgICAgICAgICogQHBhcmFtIHs/fSBpbWFnZVxuICAgICAgICAgICAgICogQHJldHVybiB7P31cbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgaW1hZ2UgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlSW1hZ2VGcm9tR2FsbGVyeShpbWFnZSk7XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0gez99IGNoYW5nZXNcbiAgICAgKiBAcmV0dXJuIHs/fVxuICAgICAqL1xuICAgIHByb2Nlc3NJbWFnZXMoY2hhbmdlcykge1xuICAgICAgICAvKiogQHR5cGUgez99ICovXG4gICAgICAgIGNvbnN0IGltYWdlc1RvUHJvY2VzcyA9IHRoaXMuZ2V0QWRkZWRBbmRSZW1vdmVzSW1hZ2VzKGNoYW5nZXMpO1xuICAgICAgICAvLyBhZGQgaW1hZ2VzIHRvIG1hbnNvbnJ5IGxheW91dFxuICAgICAgICB0aGlzLmFkZEltYWdlcyhpbWFnZXNUb1Byb2Nlc3MuYWRkZWRJbWFnZXMpO1xuICAgICAgICAvLyByZW1vdmVzIGltYWdlcyBmcm9tIGxheW91dFxuICAgICAgICB0aGlzLnJlbW92ZUltYWdlcyhpbWFnZXNUb1Byb2Nlc3MucmVtb3ZlZEltYWdlcyk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHs/fSBjaGFuZ2VzXG4gICAgICogQHJldHVybiB7P31cbiAgICAgKi9cbiAgICBnZXRBZGRlZEFuZFJlbW92ZXNJbWFnZXMoY2hhbmdlcykge1xuICAgICAgICAvKiogQHR5cGUgez99ICovXG4gICAgICAgIGxldCBhZGRlZEltYWdlcyA9IFtdO1xuICAgICAgICAvKiogQHR5cGUgez99ICovXG4gICAgICAgIGNvbnN0IHJlbW92ZWRJbWFnZXMgPSBbXTtcbiAgICAgICAgLyoqIEB0eXBlIHs/fSAqL1xuICAgICAgICBjb25zdCBuZXdJbWFnZXNWYWx1ZSA9ICgvKiogQHR5cGUgez99ICovIChjaGFuZ2VzLmltYWdlc1xuICAgICAgICAgICAgLmN1cnJlbnRWYWx1ZSkpO1xuICAgICAgICAvKiogQHR5cGUgez99ICovXG4gICAgICAgIGNvbnN0IG9sZEltYWdlc1ZhbHVlID0gKC8qKiBAdHlwZSB7P30gKi8gKGNoYW5nZXMuaW1hZ2VzXG4gICAgICAgICAgICAucHJldmlvdXNWYWx1ZSkpO1xuICAgICAgICBpZiAoIW9sZEltYWdlc1ZhbHVlKSB7XG4gICAgICAgICAgICAvLyBhbGwgaW1hZ2VzIGFyZSBuZXcgb25lc1xuICAgICAgICAgICAgYWRkZWRJbWFnZXMgPSBjaGFuZ2VzLmltYWdlcy5jdXJyZW50VmFsdWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAvLyBwcm9jZXNzIGFkZGVkIGltYWdlc1xuICAgICAgICAgICAgbmV3SW1hZ2VzVmFsdWUuZm9yRWFjaCgoLyoqXG4gICAgICAgICAgICAgKiBAcGFyYW0gez99IG5ld0ltYWdlXG4gICAgICAgICAgICAgKiBAcmV0dXJuIHs/fVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBuZXdJbWFnZSA9PiB7XG4gICAgICAgICAgICAgICAgLyoqIEB0eXBlIHs/fSAqL1xuICAgICAgICAgICAgICAgIGNvbnN0IGV4aXN0aW5nSW1hZ2UgPSBvbGRJbWFnZXNWYWx1ZS5maW5kKCgvKipcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0gez99IG1cbiAgICAgICAgICAgICAgICAgKiBAcmV0dXJuIHs/fVxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIG0gPT4gbS5pbWFnZVVybC50b0xvd2VyQ2FzZSgpID09PSBuZXdJbWFnZS5pbWFnZVVybC50b0xvd2VyQ2FzZSgpKSk7XG4gICAgICAgICAgICAgICAgaWYgKGV4aXN0aW5nSW1hZ2UpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gaW1hZ2Ugd2FzIGluIHByZXZpb3VzIHZhbHVlICYmIGlzIGluIG5ldywgZG8gbm90aGluZ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gaW1hZ2UgaXMgbmV3XG4gICAgICAgICAgICAgICAgICAgIGFkZGVkSW1hZ2VzLnB1c2gobmV3SW1hZ2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIC8vIHByb2Nlc3MgcmVtb3ZlZCBpbWFnZXNcbiAgICAgICAgICAgIG9sZEltYWdlc1ZhbHVlLmZvckVhY2goKC8qKlxuICAgICAgICAgICAgICogQHBhcmFtIHs/fSBvbGRJbWFnZVxuICAgICAgICAgICAgICogQHJldHVybiB7P31cbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgb2xkSW1hZ2UgPT4ge1xuICAgICAgICAgICAgICAgIC8qKiBAdHlwZSB7P30gKi9cbiAgICAgICAgICAgICAgICBjb25zdCBleGlzdGluZ0ltYWdlID0gbmV3SW1hZ2VzVmFsdWUuZmluZCgoLyoqXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHs/fSBtXG4gICAgICAgICAgICAgICAgICogQHJldHVybiB7P31cbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBtID0+IG0uaW1hZ2VVcmwudG9Mb3dlckNhc2UoKSA9PT0gb2xkSW1hZ2UuaW1hZ2VVcmwudG9Mb3dlckNhc2UoKSkpO1xuICAgICAgICAgICAgICAgIGlmIChleGlzdGluZ0ltYWdlKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGltYWdlIHdhcyBpbiBwcmV2aW91cyB2YWx1ZSAmJiBpcyBpbiBuZXcsIGRvIG5vdGhpbmdcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGltYWdlIGlzIHJlbW92ZWRcbiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlZEltYWdlcy5wdXNoKG9sZEltYWdlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGFkZGVkSW1hZ2VzOiBhZGRlZEltYWdlcyxcbiAgICAgICAgICAgIHJlbW92ZWRJbWFnZXM6IHJlbW92ZWRJbWFnZXNcbiAgICAgICAgfTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcmV0dXJuIHs/fVxuICAgICAqL1xuICAgIGluaXRNYXNvbnJ5KCkge1xuICAgICAgICB0aGlzLmdyaWQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzLmdhbGxlcnlHdWlkKTtcbiAgICAgICAgLy8gcmVtb3ZlIGFsbCBleGlzdGluZyBkYXRhIGZyb20gZ3JpZFxuICAgICAgICB0aGlzLmdyaWQuaW5uZXJIVE1MID0gJyc7XG4gICAgICAgIGlmICghdGhpcy5ncmlkKSB7XG4gICAgICAgICAgICB0aHJvdyBFcnJvcihgQ291bGQgbm90IGluaXQgbWFuc29yeSBkdWUgdG8gbm9uIGV4aXN0aW5nIGVsZW0gd2l0aCBpZCAnJHt0aGlzLmdhbGxlcnlHdWlkfSdgKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLm1zbnJ5ID0gbmV3IG1hc29ucnkodGhpcy5ncmlkLCB7XG4gICAgICAgICAgICAvLyBvcHRpb25zLi4uXG4gICAgICAgICAgICBpdGVtU2VsZWN0b3I6ICcuJyArIHRoaXMubWFuc29ucnlJdGVtU2VsZWN0b3JDbGFzcyxcbiAgICAgICAgICAgIGNvbHVtbldpZHRoOiB0aGlzLndpZHRoLFxuICAgICAgICAgICAgZ3V0dGVyOiB0aGlzLmd1dHRlcixcbiAgICAgICAgfSk7XG4gICAgICAgIC8qKiBAdHlwZSB7P30gKi9cbiAgICAgICAgY29uc3QgdGhhdCA9IHRoaXM7XG4gICAgICAgIHRoaXMubXNucnkub24oJ2xheW91dENvbXBsZXRlJywgKC8qKlxuICAgICAgICAgKiBAcGFyYW0gez99IGl0ZW1zXG4gICAgICAgICAqIEByZXR1cm4gez99XG4gICAgICAgICAqL1xuICAgICAgICBmdW5jdGlvbiAoaXRlbXMpIHtcbiAgICAgICAgICAgIHRoYXQubGF5b3V0Q29tcGxldGUubmV4dChpdGVtcyk7XG4gICAgICAgIH0pKTtcbiAgICAgICAgdGhpcy5tc25yeS5vbigncmVtb3ZlQ29tcGxldGUnLCAoLyoqXG4gICAgICAgICAqIEBwYXJhbSB7P30gaXRlbXNcbiAgICAgICAgICogQHJldHVybiB7P31cbiAgICAgICAgICovXG4gICAgICAgIGZ1bmN0aW9uIChpdGVtcykge1xuICAgICAgICAgICAgdGhhdC5yZW1vdmVDb21wbGV0ZS5uZXh0KGl0ZW1zKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7P30gaW1hZ2VcbiAgICAgKiBAcmV0dXJuIHs/fVxuICAgICAqL1xuICAgIHJlbW92ZUltYWdlRnJvbUdhbGxlcnkoaW1hZ2UpIHtcbiAgICAgICAgLy8gZ2V0IGltYWdlIGd1aWRcbiAgICAgICAgLyoqIEB0eXBlIHs/fSAqL1xuICAgICAgICBjb25zdCBpbWFnZUlkUmVzdWx0ID0gdGhpcy5hY3RpdmVJbWFnZXMuZmluZCgoLyoqXG4gICAgICAgICAqIEBwYXJhbSB7P30gbVxuICAgICAgICAgKiBAcmV0dXJuIHs/fVxuICAgICAgICAgKi9cbiAgICAgICAgbSA9PiBtLmltYWdlLmltYWdlVXJsLnRvTG93ZXJDYXNlKCkgPT09IGltYWdlLmltYWdlVXJsLnRvTG93ZXJDYXNlKCkpKTtcbiAgICAgICAgaWYgKCFpbWFnZUlkUmVzdWx0KSB7XG4gICAgICAgICAgICAvLyBpbWFnZSB3YXMgbm90IGZvdW5kLCB0aGlzIGlzIHByb2JhYmx5IGFuIGVycm9yXG4gICAgICAgICAgICBjb25zb2xlLndhcm4oYEltYWdlIHdpdGggdXJsICcke2ltYWdlLmltYWdlVXJsfScgd2FzIG5vdCBmb3VuZC4gSWYgeW91IGFyZSBhZGRpbmcgaW1hZ2VzLCBtYWtlIHN1cmUgdG8gJ3JlcGxhY2UnIHRoZSBpbWFnZXMgYXJyYXkgd2l0aCBhIG5ldyBvbmVcbiAgICAgICAgICAgICAgICBzbyB0aGF0IGRldGVjdGlvbiBjaGFuZ2UgY2FuIGJlIGV4ZWN1dGVkIGluc3RlYWQgb2YganVzdCBhZGRpbmcgYW4gaW1hZ2UgdG8gYXJyYXlcbiAgICAgICAgICAgICAgICAod2hpY2ggZG9lc24ndCBmaXJlIGNoYW5nZSBkZXRlY3Rpb24gb24gYXJyYXkgcHJvcGVydHkpYCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy8gZmluZCBpbWFnZSBiYXNlZCBvbiBpdHMgaWRcbiAgICAgICAgLyoqIEB0eXBlIHs/fSAqL1xuICAgICAgICBjb25zdCBpbWFnZUVsZW0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpbWFnZUlkUmVzdWx0LmlkKTtcbiAgICAgICAgaWYgKCFpbWFnZUVsZW0pIHtcbiAgICAgICAgICAgIC8vIGltYWdlIHdhcyBub3QgZm91bmQgaW4gRE9NXG4gICAgICAgICAgICBjb25zb2xlLndhcm4oYEltYWdlIHdpdGggaWQgJ3ske2ltYWdlSWRSZXN1bHQuaWR9fScgd2FzIG5vdCBmb3VuZCBpbiBET00uIEhhdmUgeW91IG1hbmlwdWxhdGVkIHRoZSBET00gaW4gc29tZSB3YXk/YCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy8gcmVtb3ZlIGltYWdlIGZyb20gZ2FsbGVyeVxuICAgICAgICB0aGlzLm1zbnJ5LnJlbW92ZShpbWFnZUVsZW0pO1xuICAgICAgICAvLyByZWZyZXNoIGxheW91dFxuICAgICAgICB0aGlzLm1zbnJ5LmxheW91dCgpO1xuICAgICAgICAvLyByZW1vdmUgaW1hZ2UgZnJvbSBhcnJheVxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuYWN0aXZlSW1hZ2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAvKiogQHR5cGUgez99ICovXG4gICAgICAgICAgICBjb25zdCBpZFdpdGhJbWFnZSA9IHRoaXMuYWN0aXZlSW1hZ2VzW2ldO1xuICAgICAgICAgICAgaWYgKGlkV2l0aEltYWdlLmltYWdlLmltYWdlVXJsLnRvTG93ZXJDYXNlKCkgPT09XG4gICAgICAgICAgICAgICAgaW1hZ2VJZFJlc3VsdC5pbWFnZS5pbWFnZVVybC50b0xvd2VyQ2FzZSgpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hY3RpdmVJbWFnZXMuc3BsaWNlKGksIDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHs/fSBpbWFnZXNcbiAgICAgKiBAcmV0dXJuIHs/fVxuICAgICAqL1xuICAgIGFkZEltYWdlc1RvR2FsbGVyeShpbWFnZXMpIHtcbiAgICAgICAgaWYgKCF0aGlzLmdyaWQpIHtcbiAgICAgICAgICAgIHRocm93IEVycm9yKCdHcmlkIGVsZW1lbnQgaXMgbm90IHlldCByZWFkeSwgYXJlIHlvdSB0cnlpbmcgdG8gYWRkIGltYWdlIHRvbyBzb29uPycpO1xuICAgICAgICB9XG4gICAgICAgIC8qKiBAdHlwZSB7P30gKi9cbiAgICAgICAgY29uc3QgaW1hZ2VzV3JhcHBlciA9IHRoaXMucmVuZGVyZXIuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICAgICAgICBpbWFnZXMuZm9yRWFjaCgoLyoqXG4gICAgICAgICAqIEBwYXJhbSB7P30gaW1hZ2VcbiAgICAgICAgICogQHJldHVybiB7P31cbiAgICAgICAgICovXG4gICAgICAgIGltYWdlID0+IHtcbiAgICAgICAgICAgIC8vIGdlbmVyYXRlIHVuaXF1ZSBpbWFnZSBpZFxuICAgICAgICAgICAgLyoqIEB0eXBlIHs/fSAqL1xuICAgICAgICAgICAgY29uc3QgaW1hZ2VJZCA9IHRoaXMuZ2V0SW1hZ2VJZCgpO1xuICAgICAgICAgICAgLy8gY3JlYXRlIGVsZW1lbnRcbiAgICAgICAgICAgIC8qKiBAdHlwZSB7P30gKi9cbiAgICAgICAgICAgIGNvbnN0IGltYWdlRWxlbSA9IHRoaXMucmVuZGVyZXIuY3JlYXRlRWxlbWVudCgnaW1nJyk7XG4gICAgICAgICAgICBpbWFnZUVsZW0uc2V0QXR0cmlidXRlKCdpZCcsIGltYWdlSWQpO1xuICAgICAgICAgICAgaW1hZ2VFbGVtLnNldEF0dHJpYnV0ZSgnYWx0JywgaW1hZ2UuYWx0ID8gaW1hZ2UuYWx0IDogJ25vIGRlc2NyaXB0aW9uJyk7XG4gICAgICAgICAgICBpbWFnZUVsZW0uc2V0QXR0cmlidXRlKCdzcmMnLCBpbWFnZS5pbWFnZVVybCk7XG4gICAgICAgICAgICAvLyBub3RlIC0gaW1hZ2VzIGFyZSBoaWRkZW4gYnkgZGVmYXVsdCBhbmQgc2hvdWxkIGJlIHNob3duIG9ubHkgYWZ0ZXIgdGhleSBhcmUgbG9hZGVkXG4gICAgICAgICAgICBpbWFnZUVsZW0uc2V0QXR0cmlidXRlKCdzdHlsZScsIGBkaXNwbGF5OiBub25lOyB3aWR0aDogJHt0aGlzLndpZHRofXB4OyBtYXJnaW4tYm90dG9tOiAke3RoaXMudmVydGljYWxHdXR0ZXJ9cHhgKTtcbiAgICAgICAgICAgIGltYWdlRWxlbS5jbGFzc05hbWUgPSB0aGlzLmdldEltYWdlQ2xhc3MoKTtcbiAgICAgICAgICAgIGltYWdlRWxlbS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgvKipcbiAgICAgICAgICAgICAqIEByZXR1cm4gez99XG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUNsaWNrKGltYWdlKTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIC8vIHN0b3JlIGd1aWQgd2l0aCB0aGlzIGltYWdlXG4gICAgICAgICAgICB0aGlzLmFjdGl2ZUltYWdlcy5wdXNoKHtcbiAgICAgICAgICAgICAgICBpZDogaW1hZ2VJZCxcbiAgICAgICAgICAgICAgICBpbWFnZTogaW1hZ2VcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgLy8gYWRkIHRvIGRvbSBhbmQgbWFuc29yeSAmIHJlZnJlc2ggbGF5b3V0XG4gICAgICAgICAgICB0aGlzLnJlbmRlcmVyLmFwcGVuZENoaWxkKGltYWdlc1dyYXBwZXIsIGltYWdlRWxlbSk7XG4gICAgICAgIH0pKTtcbiAgICAgICAgLy8gYWRkIGh0bWwgdG8gZG9tXG4gICAgICAgIHRoaXMucmVuZGVyZXIuYXBwZW5kQ2hpbGQodGhpcy5ncmlkLCBpbWFnZXNXcmFwcGVyKTtcbiAgICAgICAgLy8gYWRkIGltYWdlcyBvbmNlIHRoZXkgYXJlIGxvYWRlZFxuICAgICAgICAvKiogQHR5cGUgez99ICovXG4gICAgICAgIGNvbnN0IGltZ0xvYWQgPSBpbWFnZXNMb2FkZWRNZXRob2QoaW1hZ2VzV3JhcHBlcik7XG4gICAgICAgIGltZ0xvYWQub24oJ3Byb2dyZXNzJywgKC8qKlxuICAgICAgICAgKiBAcGFyYW0gez99IGluc3RhbmNlXG4gICAgICAgICAqIEBwYXJhbSB7P30gaW1hZ2VcbiAgICAgICAgICogQHJldHVybiB7P31cbiAgICAgICAgICovXG4gICAgICAgIChpbnN0YW5jZSwgaW1hZ2UpID0+IHtcbiAgICAgICAgICAgIGlmIChpbWFnZS5pc0xvYWRlZCkge1xuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyZXIuYXBwZW5kQ2hpbGQodGhpcy5ncmlkLCBpbWFnZS5pbWcpO1xuICAgICAgICAgICAgICAgIC8vIHVuaGlkZSBpbWFnZVxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUoaW1hZ2UuaW1nLCAnZGlzcGxheScsICdibG9jaycpO1xuICAgICAgICAgICAgICAgIHRoaXMubXNucnkuYXBwZW5kZWQoaW1hZ2UuaW1nKTtcbiAgICAgICAgICAgICAgICB0aGlzLm1zbnJ5LnJlbG9hZEl0ZW1zKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcmV0dXJuIHs/fVxuICAgICAqL1xuICAgIGdldEltYWdlQ2xhc3MoKSB7XG4gICAgICAgIC8qKiBAdHlwZSB7P30gKi9cbiAgICAgICAgbGV0IGNsYXNzTmFtZSA9IHRoaXMubWFuc29ucnlJdGVtU2VsZWN0b3JDbGFzcztcbiAgICAgICAgaWYgKHRoaXMuaW1hZ2VDbGFzc2VzICYmIHRoaXMuaW1hZ2VDbGFzc2VzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIC8qKiBAdHlwZSB7P30gKi9cbiAgICAgICAgICAgIGNvbnN0IGN1c3RvbUNsYXNzID0gdGhpcy5pbWFnZUNsYXNzZXMuam9pbignICcpO1xuICAgICAgICAgICAgY2xhc3NOYW1lICs9ICcgJyArIGN1c3RvbUNsYXNzO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjbGFzc05hbWU7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHJldHVybiB7P31cbiAgICAgKi9cbiAgICBnZXRJbWFnZUlkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nYWxsZXJ5R3VpZCArICdfJyArIHV0aWxpdGllcy5uZXdHdWlkKCk7XG4gICAgfVxufVxuTWFzb25yeUdhbGxlcnlDb21wb25lbnQuZGVjb3JhdG9ycyA9IFtcbiAgICB7IHR5cGU6IENvbXBvbmVudCwgYXJnczogW3tcbiAgICAgICAgICAgICAgICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbiAgICAgICAgICAgICAgICBzZWxlY3RvcjogJ25neC1tYXNvbnJ5LWdhbGxlcnknLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAnPGRpdiBbaWRdPVwiZ2FsbGVyeUd1aWRcIj48L2Rpdj4nXG4gICAgICAgICAgICB9XSB9XG5dO1xuLyoqIEBub2NvbGxhcHNlICovXG5NYXNvbnJ5R2FsbGVyeUNvbXBvbmVudC5jdG9yUGFyYW1ldGVycyA9ICgpID0+IFtcbiAgICB7IHR5cGU6IFJlbmRlcmVyMiB9XG5dO1xuTWFzb25yeUdhbGxlcnlDb21wb25lbnQucHJvcERlY29yYXRvcnMgPSB7XG4gICAgaW1hZ2VzOiBbeyB0eXBlOiBJbnB1dCB9XSxcbiAgICB3aWR0aDogW3sgdHlwZTogSW5wdXQgfV0sXG4gICAgZ3V0dGVyOiBbeyB0eXBlOiBJbnB1dCB9XSxcbiAgICB2ZXJ0aWNhbEd1dHRlcjogW3sgdHlwZTogSW5wdXQgfV0sXG4gICAgaW1hZ2VDbGFzc2VzOiBbeyB0eXBlOiBJbnB1dCB9XSxcbiAgICBjbGlja0ltYWdlOiBbeyB0eXBlOiBPdXRwdXQgfV0sXG4gICAgcmVtb3ZlQ29tcGxldGU6IFt7IHR5cGU6IE91dHB1dCB9XSxcbiAgICBsYXlvdXRDb21wbGV0ZTogW3sgdHlwZTogT3V0cHV0IH1dXG59O1xuaWYgKGZhbHNlKSB7XG4gICAgLyoqIEB0eXBlIHs/fSAqL1xuICAgIE1hc29ucnlHYWxsZXJ5Q29tcG9uZW50LnByb3RvdHlwZS5pbWFnZXM7XG4gICAgLyoqIEB0eXBlIHs/fSAqL1xuICAgIE1hc29ucnlHYWxsZXJ5Q29tcG9uZW50LnByb3RvdHlwZS53aWR0aDtcbiAgICAvKiogQHR5cGUgez99ICovXG4gICAgTWFzb25yeUdhbGxlcnlDb21wb25lbnQucHJvdG90eXBlLmd1dHRlcjtcbiAgICAvKiogQHR5cGUgez99ICovXG4gICAgTWFzb25yeUdhbGxlcnlDb21wb25lbnQucHJvdG90eXBlLnZlcnRpY2FsR3V0dGVyO1xuICAgIC8qKiBAdHlwZSB7P30gKi9cbiAgICBNYXNvbnJ5R2FsbGVyeUNvbXBvbmVudC5wcm90b3R5cGUuaW1hZ2VDbGFzc2VzO1xuICAgIC8qKiBAdHlwZSB7P30gKi9cbiAgICBNYXNvbnJ5R2FsbGVyeUNvbXBvbmVudC5wcm90b3R5cGUuY2xpY2tJbWFnZTtcbiAgICAvKiogQHR5cGUgez99ICovXG4gICAgTWFzb25yeUdhbGxlcnlDb21wb25lbnQucHJvdG90eXBlLnJlbW92ZUNvbXBsZXRlO1xuICAgIC8qKiBAdHlwZSB7P30gKi9cbiAgICBNYXNvbnJ5R2FsbGVyeUNvbXBvbmVudC5wcm90b3R5cGUubGF5b3V0Q29tcGxldGU7XG4gICAgLyoqIEB0eXBlIHs/fSAqL1xuICAgIE1hc29ucnlHYWxsZXJ5Q29tcG9uZW50LnByb3RvdHlwZS5nYWxsZXJ5R3VpZDtcbiAgICAvKipcbiAgICAgKiBAdHlwZSB7P31cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIE1hc29ucnlHYWxsZXJ5Q29tcG9uZW50LnByb3RvdHlwZS5tYW5zb25yeUl0ZW1TZWxlY3RvckNsYXNzO1xuICAgIC8qKlxuICAgICAqIEB0eXBlIHs/fVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgTWFzb25yeUdhbGxlcnlDb21wb25lbnQucHJvdG90eXBlLmFjdGl2ZUltYWdlcztcbiAgICAvKipcbiAgICAgKiBAdHlwZSB7P31cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIE1hc29ucnlHYWxsZXJ5Q29tcG9uZW50LnByb3RvdHlwZS5tc25yeTtcbiAgICAvKipcbiAgICAgKiBAdHlwZSB7P31cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIE1hc29ucnlHYWxsZXJ5Q29tcG9uZW50LnByb3RvdHlwZS5ncmlkO1xuICAgIC8qKlxuICAgICAqIEB0eXBlIHs/fVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgTWFzb25yeUdhbGxlcnlDb21wb25lbnQucHJvdG90eXBlLmNoYW5nZXNUb1Byb2Nlc3M7XG4gICAgLyoqXG4gICAgICogQHR5cGUgez99XG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBNYXNvbnJ5R2FsbGVyeUNvbXBvbmVudC5wcm90b3R5cGUudmlld1JlYWR5O1xuICAgIC8qKlxuICAgICAqIEB0eXBlIHs/fVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgTWFzb25yeUdhbGxlcnlDb21wb25lbnQucHJvdG90eXBlLnJlbmRlcmVyO1xufVxuLyoqXG4gKiBAcmVjb3JkXG4gKi9cbmZ1bmN0aW9uIEFjdGl2ZUltYWdlKCkgeyB9XG5pZiAoZmFsc2UpIHtcbiAgICAvKiogQHR5cGUgez99ICovXG4gICAgQWN0aXZlSW1hZ2UucHJvdG90eXBlLmlkO1xuICAgIC8qKiBAdHlwZSB7P30gKi9cbiAgICBBY3RpdmVJbWFnZS5wcm90b3R5cGUuaW1hZ2U7XG59XG4iXX0=